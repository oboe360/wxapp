<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
<!--[if lt IE 9]>
<script type="text/javascript" src="lib/html5.js"></script>
<script type="text/javascript" src="lib/respond.min.js"></script>
<script type="text/javascript" src="lib/PIE_IE678.js"></script>
<![endif]-->
<link href="css/H-ui.min.css" rel="stylesheet" type="text/css" />
<link href="css/H-ui.admin.css" rel="stylesheet" type="text/css" />
<link href="lib/icheck/icheck.css" rel="stylesheet" type="text/css" />
<link href="lib/Hui-iconfont/1.0.1/iconfont.css" rel="stylesheet" type="text/css" />
<link href="lib/webuploader/0.1.5/webuploader.css" rel="stylesheet" type="text/css" />
<!--[if IE 6]>
<script type="text/javascript" src="lib/DD_belatedPNG_0.0.8a-min.js" ></script>
<script>DD_belatedPNG.fix('*');</script>
<![endif]-->
<title>编辑商品</title>
<style type="text/css">
	.addselect{
		display: none;
	}
	.jiage{
		width: 120px;
	}
	.a-upload {
            float: left;
            padding: 4px 10px;
            height: 20px;
            line-height: 20px;
            position: relative;
            cursor: pointer;
            color: white;
            background: #00b7ee;
            border: 1px solid #ddd;
            border-radius: 4px;
            overflow: hidden;
            display: inline-block;
            *display: inline;
            *zoom: 1;
        text-decoration: none;
        }
        .a-upload  input {
            position: absolute;
            font-size: 100px;
            right: 0;
            top: 0;
            opacity: 0;
            filter: alpha(opacity=0);
            cursor: pointer
        }
        .a-upload:hover {
            color: white;
            background: #00b7ee;
            border-color: #ccc;
            text-decoration: none
        }
        .relative{
        	position: relative;
        	width: 110px;
        	height: 110px;
        	float: left;
        }
        .del{
        	background: url(images/acrossTab-close.png) left bottom no-repeat;
        	width: 13px;
        	height: 13px;
        	position: absolute;
        	right: 0;
        	top: 0;
        	cursor: pointer;
        }
</style>
</head>
<body>
<div class="pd-20">
	<form action="" method="post" class="form form-horizontal" id="form-article-add">
		<div class="row cl">
			<label class="form-label col-2"><span class="c-red">*</span>商品名称：</label>
			<div class="formControls col-5">
				<input type="text" class="input-text" :value="info.goods_name" placeholder="" id="spmc" name="goods_name">
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-2"><span class="c-red"></span>商品等级：</label>
			<div class="formControls col-5">
				<select name="is_top" id="is_top">
			        <option value="0" id="a0">无子级商品</option>
			        <option value="1" id="a1">顶级商品</option>
			        <option value="2" id="a2">子级商品</option>
		      </select>
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-2"><span class="c-red"></span>父级ID：</label>
			<div class="formControls col-5">
				<input type="text" class="input-text" :value="info.prent_id" value="" placeholder="" id="spmc" name="prent_id">
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-2">子级特性描述：</label>
			<div class="formControls col-5">
				<textarea name="name" id="td" cols="" rows="" class="textarea"  placeholder="说点什么...最少输入10个字符" datatype="*10-100" dragonfly="true" nullmsg="备注不能为空！" :value="info.name" onKeyUp="textarealength(this,200)"></textarea>
				<p class="textarea-numberbar"><em class="textarea-length">0</em>/200</p>
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-2">视频连接：</label>
	        
			<div class="formControls col-5">
			<input type="hidden" name="field_url" value="http://p2y9lnq1a.bkt.clouddn.com/">
			<input type="hidden" name="token_url" value="../Admin/Goods/token?bucket=goods-video">

            <a class="btn btn-default btn-lg " id="pickfiles" href="#" >
                <i class="glyphicon glyphicon-plus"></i>
                <span>选择文件</span>
            </a>
            <div v-show="!!info.goods_lianjie" id="success" class="col-md-12">
	            <video :src="info.goods_lianjie" id="video" width="100" height="100" controls="controls" ></video>
	        </div>
				<input type="hidden" class="input-text" value="" placeholder="" id="goods_video" name="goods_lianjie">
			</div>
		</div>
		<div class="row cl" id="table" style="display: none;">
		<label class="form-label col-2"></label>
		<div class="formControls col-10">
            <table class="table table-border table-bordered table-bg mt-20">
                <thead>
                  <tr>
                    <th class="progressName">Filename</th>
                    <th class="progressFileSize">Size</th>
                    <th>Detail</th>
                  </tr>
                </thead>
                <tbody id="fsUploadProgress">
                </tbody>
            </table>
        </div>
        </div>
		<div class="row cl">
			<label class="form-label col-2">规格：</label>
			<div class="formControls col-5">
				<input type="text" class="input-text" :value="info.goods_guige" placeholder="" id="gg" name="goods_guige">
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-2">产地：</label>
			<div class="formControls col-5">
				<input type="text" class="input-text" :value="info.goods_diqu" placeholder="" id="cd" name="goods_diqu">
			</div>
		</div>
		<!-- <div class="row cl">
			<label class="form-label col-2">运费：</label>
			<div class="formControls col-5">
				<input type="text" class="input-text" :value="info.goods_baoz" placeholder="" id="yf" name="goods_baoz">
			</div>
		</div> -->
		<div class="row cl">
			<label class="form-label col-2">库存：</label>
			<div class="formControls col-5">
				<input type="text" class="input-text" :value="info.goods_number" placeholder="" id="goods_number" name="goods_number">
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-2">初始销量：</label>
			<div class="formControls col-5">
				<input type="text" class="input-text" :value="info.offline_count" placeholder="" id="offline_count" name="offline_count">
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-2">重量(kg)：</label>
			<div class="formControls col-5">
				<input type="text" class="input-text" :value="info.goods_weight" placeholder="" id="" name="goods_weight">
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-2">普通用户价格：</label>
			<div class="formControls col-5">
				<input type="text" class="input-text" :value="info.market_price" placeholder="" id="jg" name="market_price">
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-2">会员价格：</label>
			<div class="formControls col-5">
				<input type="text" class="input-text" :value="info.shop_price" placeholder="" id="jg" name="shop_price">
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-2">店铺分佣(%)：</label>
			<div class="formControls col-5">
				<input type="text" class="input-text" :value="info.shop_comm" placeholder="" id="jg" name="shop_comm">
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-2">一级分佣(%)：</label>
			<div class="formControls col-5">
				<input type="text" class="input-text" :value="info.first_comm" placeholder="" id="jg" name="first_comm">
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-2">二级分佣(%)：</label>
			<div class="formControls col-5">
				<input type="text" class="input-text" :value="info.second_comm" placeholder="" id="jg" name="second_comm">
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-2">特点：</label>
			<div class="formControls col-5">
				<textarea name="goods_td" id="td" cols="" rows="" class="textarea"  placeholder="说点什么...最少输入10个字符" datatype="*10-100" dragonfly="true" nullmsg="备注不能为空！" :value="info.goods_td" onKeyUp="textarealength(this,200)"></textarea>
				<p class="textarea-numberbar"><em class="textarea-length">0</em>/200</p>
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-2">商品简单描述：</label>
			<div class="formControls col-5">
				<textarea name="goods_brief" id="td" cols="" rows="" class="textarea"  placeholder="说点什么...最少输入10个字符" datatype="*10-100" dragonfly="true" nullmsg="备注不能为空！" :value="info.goods_brief" onKeyUp="textarealength(this,200)"></textarea>
				<p class="textarea-numberbar"><em class="textarea-length">0</em>/200</p>
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-2">商品货号：</label>
			<div class="formControls col-3">
				<input type="text" class="input-text" :value="info.goods_sn" placeholder="" id="" name="goods_sn">
				如果您不输入商品货号，系统将自动生成一个唯一的货号。
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-2"><span class="c-red">*</span>商品分类：</label>
			<div class="formControls col-2"> <span class="select-box">
				<select name="cat_id" id="Mmonth" class="select">
					
				</select>
				</span> 
			</div>
			<div class="formControls col-3">
				<input class="btn btn-default btn-uploadstar radius ml-10" type="button" onClick="addselect(this)" value="添加分类" style="display: none;" />
				<input style="width:100px;" type="text" class="input-text addselect opitom" value="" placeholder="" id="opitom" name="">
				<input class="btn btn-default btn-uploadstar radius ml-10 addselect" type="button" onClick="add(this)" value="确定"/>
				<input class="btn btn-default btn-uploadstar radius ml-10 addselect" type="button" onClick="hide(this)" value="<<"/>
			</div>			
		</div>
		<div class="row cl">
			<label class="form-label col-2"><span class="c-red">*</span>品牌分类：</label>
			<div class="formControls col-2"> <span class="select-box">
				<select name="brand_id" id="pinpai" class="select">
					
					
				</select>
				</span> 
			</div>
		<!-- <div class="row cl">
			<label class="form-label col-2"><span class="c-red">*</span>选择供货商：</label>
			<div class="formControls col-2"> <span class="select-box">
				<select name="suppliers_id" id="ghs" class="select">
					
				</select>
				</span> 
			</div>			
		</div> -->
		<!-- <div class="row cl">
			<label class="form-label col-2"><span class="c-red">*</span>价格加油费：</label>
			<div class="formControls col-2"> 
				<input type="text" class="input-text" :value="info.shop_price" placeholder="" id="" name="shop_price">
			</div>
			<div class="formControls col-3">
				<input class="btn btn-default btn-uploadstar radius ml-10" type="button" onClick="" value="按市场价计算"/>
			</div>
		</div> -->
		<!-- <div class="row cl">
			<label class="form-label col-2"><span class="c-red">*</span>会员价格：</label>
			<div class="formControls col-8"> 
				普通用户<input type="text" class="input-text jiage" :value="info.user_price.a1" placeholder="" id="" name="user_price[]">
				普通代理商<input type="text" class="input-text jiage" :value="info.user_price.a101" placeholder="" id="" name="user_price[]">
				高级代理商<input type="text" class="input-text jiage" :value="info.user_price.a102" placeholder="" id="" name="user_price[]">
				总代理商<input type="text" class="input-text jiage" :value="info.user_price.a103" placeholder="" id="" name="user_price[]">
				高级总代<input type="text" class="input-text jiage" :value="info.user_price.a104" placeholder="" id="" name="user_price[]"> <br>
				会员价格为-1时表示会员价格按会员等级折扣率计算。你也可以为每个等级指定一个固定价格
			</div>
		</div> -->
	<!-- 	<div class="row cl">
			<label class="form-label col-2">商品优惠价格：</label>
			<div class="formControls col-8"> 					
				[+] 优惠数量<input type="text" class="input-text jiage" value="0" placeholder="" id="" name="volume_number[]">
				优惠价格<input type="text" class="input-text jiage" value="0" placeholder="" id="" name="volume_price[]"> <br>
				购买数量达到优惠数量时享受的优惠价格
			</div>
		</div> -->
		<!-- <div class="row cl">
			<label class="form-label col-2"><span class="c-red">*</span>市场售价：</label>
			<div class="formControls col-2"> 
				<input type="text" class="input-text" :value="info.market_price" placeholder="" id="" name="market_price">
			</div>
			<div class="formControls col-3">
				<input class="btn btn-default btn-uploadstar radius ml-10" type="button" onClick="" value="取整数"/>
			</div>
		</div> -->
		<!-- <div class="row cl">
			<label class="form-label col-2">赠送消费积分数：</label>
			<div class="formControls col-5"> 					
				<input type="text" class="input-text" value="0" placeholder="" id="" name="give_integral"><br>
				购买该商品时赠送消费积分数,-1表示按商品价格赠送
			</div>
		</div> -->
		<!-- <div class="row cl">
			<label class="form-label col-2">赠送等级积分数：</label>
			<div class="formControls col-5"> 					
				<input type="text" class="input-text" value="0" placeholder="" id="" name="rank_integral"><br>
				购买该商品时赠送消费积分数,-1表示按商品价格赠送
			</div>
		</div> -->
	<!-- 	<div class="row cl">
			<label class="form-label col-2">积分购买金额：</label>
			<div class="formControls col-5"> 					
				<input type="text" class="input-text" value="0" placeholder="" id="" name="integral"><br>
				此处需填写金额)购买该商品时最多可以使用积分的金额
			</div>
		</div> -->
	<!-- 	<div class="row cl">
			<label class="form-label col-2"><input type="checkbox" id="cuxiao" name="cuxiao">促销价：</label>
			<div class="formControls col-2">
				<input type="text" class="input-text cx" disabled value="0" placeholder="" id="" name="promote_price">
			</div>
		</div> -->
		<!-- <div class="row cl">
			<label class="form-label col-2">促销日期：</label>
			<div class="formControls col-5">
				<input type="text" disabled onfocus="WdatePicker({dateFmt:'yyyy-MM-dd HH:mm:ss',maxDate:'#F{$dp.$D(\'logmax\')||\'%y-%M-%d\'}'})" id="logmin" class="input-text sj Wdate cx" name="promote_start_date" style="width:220px;">
		-
		<input type="text" disabled onfocus="WdatePicker({dateFmt:'yyyy-MM-dd HH:mm:ss',minDate:'#F{$dp.$D(\'logmin\')}'})" id="logmax" class="input-text Wdate cx" name="promote_end_date" style="width:220px;">
			</div>
		</div> -->

		<div class="row cl">
			<label class="form-label col-2">上传商品图片：</label>
			<div class="formControls col-5">
				<div style="margin :0px auto; width:990px;float: left;">
					 <div id="dd4" class="imgg" style=" width:990px;float: left;">
				    	<template v-if="info.goods_img != ''">
				    		<div class="relative">
				    			<img style="width:100px;height:100px;margin:5px;" :src="info.goods_img"><span v-on:click="delGoodImg($event, info.goods_id, 'goods_img', info.goods_img)" class="del"><span>
				    		<div>
				    	</template>
				    	<template v-else>
				    		
				    	</template>
				    </div>
				    <a href="javascript:;" class="a-upload">
				        <input type="file" name="fileField" id="doc4" multiple="multiple" onchange="shangc(this,dd4)"  accept="image/jpg,image/jpeg,image/png" />选择图片
				    </a>
				    <input type="hidden" value="" id="goods_img" name="goods_img">
				   
				</div>
				<input type="text" placeholder="图片外部URL" class="input-text" value="" placeholder="" id="" name="goods_img_url">
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-2">视频封面图：</label>
			 <div class="formControls col-5">
				<div style="margin :0px auto; width:990px;float: left;">
					<div id="dd3" class="imgg" style=" width:990px;float: left;">
				    	<template v-if="info.video_img != ''">
				    		<div class="relative">
				    			<img style="width:100px;height:100px;margin:5px;" :src="info.video_img"><span v-on:click="delGoodImg($event, info.goods_id, 'video_img', info.video_img)" class="del"><span>
				    		<div>
				    	</template>
				    	<template v-else>
				    		
				    	</template>
				    </div>
				    <a href="javascript:;" class="a-upload">
				        <input type="file" name="fileField" id="doc3" multiple="multiple" onchange="shangc(this,dd3)"  accept="image/jpg,image/jpeg,image/png" />选择图片
				    </a>
				    <input type="hidden" value="" id="video_img" name="video_img">
				    
				</div>
				<input type="text" placeholder="图片外部URL" class="input-text" value="" placeholder="" id="" name="video_img_url">
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-2">上传商品分享图：</label>
			<div class="formControls col-5">
				<div style="margin :0px auto; width:990px;float: left;" >
					<div id="dd2" class="imgg" style=" width:990px;float: left;">
				    	<template v-if="info.share_img != ''">
				    		<div class="relative">
				    			<img style="width:100px;height:100px;margin:5px;" :src="info.share_img"><span v-on:click="delGoodImg($event, info.goods_id, 'share_img', info.share_img)" class="del"><span>
				    		<div>
				    	</template>
				    	<template v-else>
				    		
				    	</template>
				    </div>
				    <a href="javascript:;" class="a-upload">
				        <input type="file" name="fileField" id="doc2" multiple="multiple" onchange="shangc(this,dd2)"  accept="image/jpg,image/jpeg,image/png" />选择图片
				    </a>
				    <input type="hidden" value="" id="share_img" name="share_img">
				    
				</div>
				<!-- <input type="text" placeholder="商品分享图外部URL" class="input-text" value="" placeholder="" id="" name="share_img_url"> -->
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-2">爆款图片：</label>
			<div class="formControls col-5">
				<div style="margin :0px auto; width:990px;float: left;">
					<div id="dd1" class="imgg" style=" width:990px;float: left;">
				    	<template v-if="info.hot_image != ''">
				    		<div class="relative">
				    			<img style="width:100px;height:100px;margin:5px;" :src="info.hot_image"><span v-on:click="delGoodImg($event, info.goods_id, 'hot_image', info.hot_image)" class="del"><span>
				    		<div>
				    	</template>
				    	<template v-else>
				    		
				    	</template>
				    </div>
				    <a href="javascript:;" class="a-upload">
				        <input type="file" name="fileField" id="doc1" multiple="multiple" onchange="shangc(this,dd1)"  accept="image/jpg,image/jpeg,image/png" />选择图片
				    </a>
				    <input type="hidden" value="" id="hot_image" name="hot_image">
				    
				</div>
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-2">轮播图：</label>
			<div class="formControls col-5">
				<div style="margin :0px auto; width:990px;float: left;">
					 <div id="dd" class="imgg" style=" width:990px;float: left;">
				    	<template v-if="info.zutu.length > 0">
				    		<div class="relative" v-for="(jj,index) in info.zutu">
				    			<img style="width:100px;height:100px;margin:5px;" :src="jj.url"><span v-on:click="del($event,jj.img_id)" class="del"><span>
				    		<div>
				    	</template>
				    	<template v-else>
				    		
				    	</template>
				    </div>
				    <a href="javascript:;" class="a-upload">
				        <input type="file" name="fileField" id="doc" multiple="multiple" onchange="shangc(this,dd,10086,zutu)"  accept="image/jpg,image/jpeg,image/png" />选择图片
				    </a>
				    <input type="hidden" value="" id="zutu" name="zutu">
				</div>
				<input type="text" placeholder="新增轮播图从大到小排序：例如 3-2-1；新增几张轮播图就填几个序号" class="input-text" value="" id="" name="img_desc">
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-2" onClick="toggle()" style="cursor:pointer;" >商品描述(点击)：</label>
			<input type="hidden" id="is_edit" name="is_edit" value="">
			<input type="hidden" id="goods_id" name="goods_id" value="">
			<div class="formControls col-10"> 
				<script id="editor" type="text/plain" style="width:100%;height:400px;"></script> 
			</div>
		</div>
		<div class="row cl">
			<div class="col-10 col-offset-2">
				<button onClick="article_save_submit();" class="btn btn-primary radius" type="button"><i class="Hui-iconfont">&#xe632;</i> 保存并提交</button>
				
				<!-- <button onClick="article_save();" class="btn btn-secondary radius" type="button"><i class="Hui-iconfont">&#xe632;</i> 保存草稿</button> -->
				<button onClick="layer_close();" class="btn btn-default radius" type="button">&nbsp;&nbsp;取消&nbsp;&nbsp;</button>
			</div>
		</div>
	</form>
</div>
<script type="text/javascript" src="lib/jquery/1.9.1/jquery.min.js"></script> 
<script type="text/javascript" src="lib/layer/1.9.3/layer.js"></script> 
<script type="text/javascript" src="lib/My97DatePicker/WdatePicker.js"></script> 
<script type="text/javascript" src="lib/icheck/jquery.icheck.min.js"></script> 
<script type="text/javascript" src="lib/Validform/5.3.2/Validform.min.js"></script> 
<script type="text/javascript" src="lib/webuploader/0.1.5/webuploader.min.js"></script> 
<script type="text/javascript" src="lib/ueditor/1.4.3/ueditor.config.js"></script> 
<script type="text/javascript" src="lib/ueditor/1.4.3/ueditor.all.min.js"> </script> 
<script type="text/javascript" src="lib/ueditor/1.4.3/lang/zh-cn/zh-cn.js"></script> 
<script type="text/javascript" src="js/vue.min.js"></script>
<script type="text/javascript" src="js/H-ui.js"></script> 
<script type="text/javascript" src="js/H-ui.admin.js"></script> 
<script type="text/javascript" src="../Public/admin/scripts/bootstrap.min.js"></script>
<script type="text/javascript" src="../Public/admin/scripts/ui.js"></script>
<script type="text/javascript" src="../Public/admin/scripts/qiniu.min.js"></script>
<script type="text/javascript" src="../Public/admin/scripts/highlight.js"></script>
<script type="text/javascript" src="../Public/admin/scripts/goods_edit.js"></script>
<script type="text/javascript">
function toggle(){
	$('#editor').toggle(1000);
}
var test = window.location.href;
	// alert(test);
$.ajax({
  url:test,
  dataType:'json',
  data:{},
  beforeSend :function(xmlHttp){ 
   xmlHttp.setRequestHeader("If-Modified-Since","0"); 
   xmlHttp.setRequestHeader("Cache-Control","no-cache");
  },
  success:function(response){
    //操作
    // alert(response);
    location.reload();
  }
  // async:false
});
//下面用于多图片上传预览功能
    var haha=[] ;
    var zutu=[];
	function shangc(obj,dd,zt,zut){
		var fil = obj.files;
		if(zt == undefined){
			if(fil.length>1){
				alert("只能选一张")
				return
			}else{
				reads(fil[0],obj,dd,zt,i);
			}
		}else{
			for (var i = 0; i < fil.length; i++) {
				reads(fil[i],obj,dd,zt,zut,i);
			}
		}
	}
	function reads(fil,obj,dd,zt,zut,i){		
		if(zt == 10086){
			var reader = new FileReader();
			reader.readAsDataURL(fil);
			reader.onload = function(){	
				zutu.push(reader.result)			
				dd.innerHTML += "<div class='relative'><img style='width:100px;height:100px;margin:5px;' src='"+reader.result+"'><span  class='del'><span><div>";				
				var idd=$(zut).attr("id");
				document.getElementById(idd).value=zutu	
				var ul=document.getElementById('dd');
				var ul_lis=ul.getElementsByClassName('del');
				var ztleng=ul_lis.length-zutu.length;				
			    for (var i = 0;i < ul_lis.length; i++) {
			      ul_lis[i].index = i;
			      ul_lis[i].onclick=function(){
			        var j=this.index-ztleng;
			        zutu.splice(j, 1);
					$(this).parents('.relative').parents('.imgg').siblings('input').val(zutu)
					$(this).parents('.relative').remove();
			      }
			    }
			    var lll= $(obj).attr("id")
			    document.getElementById(lll).outerHTML=obj.outerHTML			
			}
		}else{
			var reader = new FileReader();
			reader.readAsDataURL(fil);
			reader.onload = function(){
				haha.push(reader.result)				
				dd.innerHTML = "<div class='relative'><img style='width:100px;height:100px;margin:5px;' src='"+reader.result+"'><span  class='del'><span><div>";
				$(obj).parents('.a-upload').siblings('input').val(haha);
				var dl=$(obj).parents('.a-upload').siblings('.imgg').attr("id");
				var ul=document.getElementById(dl);
				var ul_lis=ul.getElementsByClassName('del');
			    for (var i = 0;i < ul_lis.length; i++) {
			      ul_lis[i].index = i;
			      ul_lis[i].onclick=function(){
			        var j=this.index;
			        haha.splice(j, 1);
			       // console.log(haha)
					$(this).parents('.relative').parents('.imgg').siblings('input').val("")
					$(this).parents('.relative').remove();
			      }
			    }
			    haha=[]
			    var lll= $(obj).attr("id")
			    document.getElementById(lll).outerHTML=obj.outerHTML
			}
		}		
	}
	function del(e,img_id){
		//console.log(img_id)
		if(img_id){
			var e=$(e.currentTarget);
			$.ajax({
				url:'../Admin/Goods/delZt',
				type:'post',
				data:{
					img_id:img_id
				},
				dataType:'json',
				success: function(data){
					if(data.code == 2){
					parent.location = data.msg;
					return ;
					}
					if(data.code == 0){
						return ;
					}
					if(data.code == 1){
						data = data.msg;
					}
					console.log(data)
					if(data == 1){
						e.parents('.relative').remove();	
					}else{
						alert("删除失败")
					}
				}
			})
		}else{
			$(e.currentTarget).parents('.relative').remove();	
		}
	}
	//删除商品图片
	function delGoodImg(e,goods_id,field,url){
		//console.log(img_id)
		if(goods_id){
			var e=$(e.currentTarget);
			$.ajax({
				url:'../Admin/Goods/delGoodImg',
				type:'post',
				data:{
					goods_id:goods_id,
					field:field,
					url:url
				},
				dataType:'json',
				success: function(data){
					if(data.code == 2){
					parent.location = data.msg;
					return ;
					}
					if(data.code == 0){
						return ;
					}
					if(data.code == 1){
						data = data.msg;
					}
					console.log(data)
					if(data == 1){
						e.parents('.relative').remove();	
					}else{
						alert("删除失败")
					}
				}
			})
		}else{
			$(e.currentTarget).parents('.relative').remove();	
		}
	}
	function getQueryString(name) { 
		var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i"); 
		var r = window.location.search.substr(1).match(reg); 
		if (r != null) return unescape(r[2]); return null; 
	}
	var hehe=getQueryString("id");
	var ue;
	$("#goods_id").val(hehe);
	//alert(hehe)
	$.ajax({
		url:'../Admin/Goods/goodsdetail',
		type:'post',
		data:{
			goods_id:hehe
		},
		dataType:'json',
		success: function(data){
			// console.log(data);
			// return ;
			if(data.code == 2){
					parent.location = data.msg;
					return ;
				}
				if(data.code == 0){
					return ;
				}
				if(data.code == 1){
					data = data.msg;
				}
			$('#a'+data.is_top).attr('selected',true);
			// $('#b'+data.is_burst).attr('checked',true);
			// var goods_desc = '';
		
			goods_desc(data.goods_desc);
			
			new Vue({
				el: '#form-article-add',
				data: {
					info: '',
				},
				created: function() {
					var set = this;
					set.info = data;
				},
				mounted: function () {
					bind()
				}
			});

			
		}
	})

function goods_desc(goods_desc){
	    ue = UE.getEditor('editor',{onready:function(){
		this.setContent(goods_desc);
	}});
	setTimeout(function(){
		// ue.execCommand( 'insertparagraph','asdasd');
		// $(ue.body.firstChild).html('asdasd');
		// console.log(ue.body);
		
		
		ue.addListener('contentChange',function(data){
			$('#is_edit').val(1);
			// console.log(ue.getContent());
		})
	},1000);
}
//获取商品详情
function getgoods(){
	var content = ue.getContent();
	var bool = content.indexOf('title="正在上传..."');
	if(bool == -1){
		return 1;
	}else{
		return 0;
	}
}
	// $("#cuxiao").click(function(){
	// 	if($("input[name='cuxiao']").is(':checked') == true){
	// 		$(".cx").attr("disabled",false)
	// 	}else{
	// 		$(".cx").attr("disabled",true)
	// 	}
	// })
	$.ajax({
		url:'../Admin/Goods/getBra_Cat_Sup',
		dataType:'json',
		success: function(data){
			if(data.code == 2){
				parent.location = data.msg;
				return ;
			}
			if(data.code == 0){
				return ;
			}
			if(data.code == 1){
				data = data.msg;
			}
			// console.log(data);
			var str='',ghs='', lx='';
			for(var i=0;i<data.brand.length;i++){
				str+='<option value=" '+data.brand[i].brand_id+' "> '+ data.brand[i].brand_name+'</option>'
			}
			for( var i=0;i<data.category.length;i++){
				lx+='<option value=" '+data.category[i].cat_id+' "> '+ data.category[i].cat_name+'</option>'
			}
			// for( var i=0;i<data.suppliers.length;i++){
			// 	ghs+='<option value=" '+data.suppliers[i].suppliers_id+' "> '+ data.suppliers[i].suppliers_name+'</option>'
			// }
			//console.log(data.suppliers.length);
			$("#pinpai").html(str)
			$("#Mmonth").html(lx)
			// $("#ghs").html(ghs)
		}
	})
	function article_save_submit(){
		if($('#is_edit').val() == 1){
			content = getgoods();
			if(content != 1){
				alert('请等待商品详情图片上传完毕！');
				return ;
			}
		}
		//console.log(ue)
		// console.log(ue.body.innerText)
		//return;
		$('[type="button"]').prop('disabled',true)
		$.ajax({
			'url':'../Admin/Goods/saveAdd',
			'type':'post',
			'data':$('#form-article-add').serialize(),
			'datatype':"jsonpp",
			 success:function(data,err){
			 	var data = eval('(' + data + ')'); 
			 	if(data.code == 2){
					layer.msg('权限不足!',{icon: 6,time:1000});
					window.setTimeout(function(){
						top.location.href = data.msg;
						
					},1000);	
					return ;
				}
				if(data.code == 0){
					$('[type="button"]').prop('disabled',false);
					layer.msg('修改失败!',{icon: 6,time:1000});
					return ;
				}
				if(data.code == 1){
					data = data.msg;
				}
				if(data == 1){
					layer.msg('修改成功!',{icon: 6,time:1000});
					window.setTimeout(function(){
						parent.location = 'goodsList.html';
					},1000);
				}else{
					$('[type="button"]').prop('disabled',false);
					layer.msg('修改失败!',{icon: 6,time:1000});
				}
				// console.log(typeof(data))
				 // console.log(data)
			}
		})
	}
	function addselect(obj){
		$(obj).parents(".formControls").find(".addselect").show(500)
	}
	function hide(obj){
		$(obj).parents(".formControls").find(".addselect").hide(500)
	}
	function add(obj) {
		var val=$(obj).siblings(".opitom").val();
		if(val == ''){
			return ;
		}
		$(obj).parents(".formControls").siblings().find(".select-box .select").append("<option value='100'>"+val+"</option>");
		// document.getElementById("Mmonth").options.add(new Option(val, 100));
		var objSelect =$(obj).parents(".formControls").siblings().find(".select-box .select option");
		for (var i = 0; i < objSelect.length; i++) { 
			if (objSelect[i].text == val) { 
			 	objSelect[i].selected = true; 
			} 
		}
		$(obj).siblings(".opitom").val('');
		$(obj).parents(".formControls").find(".addselect").hide(500)
	}
</script>
</body>
</html>